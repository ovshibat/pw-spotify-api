# Playwright Spotify API Automation

This project uses Playwright's API testing features to exercise Spotify Web API endpoints by authenticating via client credentials or PKCE refresh flows before issuing requests.​:codex-file-citation[codex-file-citation]{line_range_start=10 line_range_end=38 path=tests/fixtures.ts git_url="https://github.com/ovshibat/pw-spotify-api/blob/main/tests/fixtures.ts#L10-L38"}​​:codex-file-citation[codex-file-citation]{line_range_start=3 line_range_end=22 path=src/spotifyAuth.ts git_url="https://github.com/ovshibat/pw-spotify-api/blob/main/src/spotifyAuth.ts#L3-L22"}​​:codex-file-citation[codex-file-citation]{line_range_start=12 line_range_end=38 path=src/spotifyPkce.ts git_url="https://github.com/ovshibat/pw-spotify-api/blob/main/src/spotifyPkce.ts#L12-L38"}​

## Features
- Reusable token helpers built on `node-fetch` for the client credentials and PKCE refresh grants.​:codex-file-citation[codex-file-citation]{line_range_start=3 line_range_end=22 path=src/spotifyAuth.ts git_url="https://github.com/ovshibat/pw-spotify-api/blob/main/src/spotifyAuth.ts#L3-L22"}​​:codex-file-citation[codex-file-citation]{line_range_start=12 line_range_end=38 path=src/spotifyPkce.ts git_url="https://github.com/ovshibat/pw-spotify-api/blob/main/src/spotifyPkce.ts#L12-L38"}​
- Custom Playwright fixture that provisions an authenticated `APIRequestContext` pointed at `https://api.spotify.com/v1`.​:codex-file-citation[codex-file-citation]{line_range_start=10 line_range_end=31 path=tests/fixtures.ts git_url="https://github.com/ovshibat/pw-spotify-api/blob/main/tests/fixtures.ts#L10-L31"}​
- Example tests covering track search and the current user profile (requires refresh token scope).​:codex-file-citation[codex-file-citation]{line_range_start=3 line_range_end=8 path=tests/search.spec.ts git_url="https://github.com/ovshibat/pw-spotify-api/blob/main/tests/search.spec.ts#L3-L8"}​​:codex-file-citation[codex-file-citation]{line_range_start=3 line_range_end=12 path=tests/me.spec.ts git_url="https://github.com/ovshibat/pw-spotify-api/blob/main/tests/me.spec.ts#L3-L12"}​

## Getting Started
1. Install dependencies with `npm install` to pull the Playwright test runner and supporting packages.​:codex-file-citation[codex-file-citation]{line_range_start=6 line_range_end=19 path=package.json git_url="https://github.com/ovshibat/pw-spotify-api/blob/main/package.json#L6-L19"}​
2. Provide your Spotify credentials via environment variables or a local `.env` file:
   - `SPOTIFY_CLIENT_ID`
   - `SPOTIFY_CLIENT_SECRET`
   - `SPOTIFY_REFRESH_TOKEN` (optional but required for `/me` tests)​:codex-file-citation[codex-file-citation]{line_range_start=14 line_range_end=25 path=tests/fixtures.ts git_url="https://github.com/ovshibat/pw-spotify-api/blob/main/tests/fixtures.ts#L14-L25"}​​:codex-file-citation[codex-file-citation]{line_range_start=3 line_range_end=11 path=tests/me.spec.ts git_url="https://github.com/ovshibat/pw-spotify-api/blob/main/tests/me.spec.ts#L3-L11"}​​:codex-file-citation[codex-file-citation]{line_range_start=1 line_range_end=25 path=playwright.config.ts git_url="https://github.com/ovshibat/pw-spotify-api/blob/main/playwright.config.ts#L1-L25"}​
3. Run the API suite with `npm test` or `npx playwright test`.​:codex-file-citation[codex-file-citation]{line_range_start=6 line_range_end=8 path=package.json git_url="https://github.com/ovshibat/pw-spotify-api/blob/main/package.json#L6-L8"}​

## Project Structure
- `src/spotifyAuth.ts` – client credentials helper for app-only access tokens.​:codex-file-citation[codex-file-citation]{line_range_start=3 line_range_end=22 path=src/spotifyAuth.ts git_url="https://github.com/ovshibat/pw-spotify-api/blob/main/src/spotifyAuth.ts#L3-L22"}​
- `src/spotifyPkce.ts` – PKCE refresh helper for user-scoped sessions.​:codex-file-citation[codex-file-citation]{line_range_start=12 line_range_end=38 path=src/spotifyPkce.ts git_url="https://github.com/ovshibat/pw-spotify-api/blob/main/src/spotifyPkce.ts#L12-L38"}​
- `tests/fixtures.ts` – shared API fixture wiring authentication into Playwright tests.​:codex-file-citation[codex-file-citation]{line_range_start=10 line_range_end=38 path=tests/fixtures.ts git_url="https://github.com/ovshibat/pw-spotify-api/blob/main/tests/fixtures.ts#L10-L38"}​
- `tests/search.spec.ts` – validates the search endpoint returns track results.​:codex-file-citation[codex-file-citation]{line_range_start=3 line_range_end=8 path=tests/search.spec.ts git_url="https://github.com/ovshibat/pw-spotify-api/blob/main/tests/search.spec.ts#L3-L8"}​
- `tests/me.spec.ts` – exercises the current user profile endpoint when a refresh token is available.​:codex-file-citation[codex-file-citation]{line_range_start=3 line_range_end=12 path=tests/me.spec.ts git_url="https://github.com/ovshibat/pw-spotify-api/blob/main/tests/me.spec.ts#L3-L12"}​
